---
title: Руководство. Использование модели Машинного обучения Azure в Power BI
titleSuffix: Azure Machine Learning
description: Сведения о том, как использовать модели Машинного обучения Azure в Power BI.
services: machine-learning
ms.service: machine-learning
ms.subservice: core
ms.topic: tutorial
ms.author: samkemp
author: samuel100
ms.reviewer: sdgilley, maggies
ms.date: 12/10/2020
ms.openlocfilehash: 6c68fff575e4da0c9126904df2de5292747c209c
ms.sourcegitcommit: 46cf62d9bb33ac7b7eae7910fbba6756f626c65f
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/15/2020
ms.locfileid: "97491789"
---
# <a name="tutorial-consume-azure-machine-learning-models-in-power-bi"></a>Руководство. Использование моделей Машинного обучения Azure в Power BI

В этом руководстве описывается создание отчета Power BI на основе модели машинного обучения. Изучив это руководство, вы сможете выполнить следующие действия:

> [!div class="checklist"]
> * оценка моделей машинного обучения (развернутых с помощью Машинного обучения Azure) в Power BI;
> * подключение к модели Машинного обучения Azure в редакторе Power Query;
> * создание отчета с визуализацией на основе этой модели;
> * публикация такого отчета в службе Power BI;
> * настройка запланированного обновления для такого отчета.

## <a name="prerequisites"></a>Предварительные требования

Перед началом работы с этим руководством вам потребуется сделать следующее:

- Обучите и разверните модель машинного обучения в Машинном обучении Azure. Воспользуйтесь одним из следующих трех руководств по Машинному обучению Azure: 

    - [Вариант A. Код.](/azure/machine-learning/tutorial-power-bi-custom-model)
    - [Вариант Б. Конструктор.](/azure/machine-learning/tutorial-power-bi-designer-model)
    - [Вариант В. Автоматизированное машинное обучение.](/azure/machine-learning/tutorial-power-bi-automated-model)

- Зарегистрируйтесь для получения [бесплатной пробной версии Power BI](https://app.powerbi.com/signupredirect?pbi_source=web).
- [Установите Power BI Desktop](https://powerbi.microsoft.com/desktop/) на локальном компьютере.

## <a name="create-the-data-model"></a>Создание модели данных

Откройте Power BI Desktop и выберите **Получение данных**. В диалоговом окне **Получение данных** выполните поиск по строке **Интернет**. Выберите источник **Интернет** > **Подключиться**.

:::image type="content" source="media/service-aml-integrate/pbi-get-data.png" alt-text="Снимок экрана: веб-данные.":::

В диалоговом окне **Из Интернета** скопируйте и вставьте следующей URL-адрес в поле:

```txt 
https://www4.stat.ncsu.edu/~boos/var.select/diabetes.tab.txt
```

:::image type="content" source="media/service-aml-integrate/pbi-data.png" alt-text="Снимок экрана: URL-адрес.":::

Щелкните **ОК**.

Выберите **Преобразовать данные**, чтобы открыть окно **Редактор Power Query**.

На ленте "Главная" в редакторе Power Query нажмите кнопку **Машинное обучение Azure**.

:::image type="content" source="media/service-aml-integrate/aml-button.png" alt-text="Снимок экрана: редактор Power Query.":::

После входа в учетную запись Azure с помощью единого входа вы увидите список доступных служб. Выберите службу **my-sklearn-service**, которую вы создали при работе с руководством "Обучение и развертывание модели машинного обучения". 

Power Query автоматически заполняет столбцы. Вы можете вспомнить, что в нашей схеме для службы есть декоратор Python, который указал входные данные. Щелкните **ОК**.

:::image type="content" source="media/service-aml-integrate/aml-pbi-run.png" alt-text="Снимок экрана: модели Машинного обучения Azure.":::

Нажмите кнопку **ОК**, чтобы вызвать службу "Машинное обучение Azure". Она активирует предупреждение о конфиденциальности для данных и конечной точки.

:::image type="content" source="media/service-aml-integrate/data_privacy_warning.png" alt-text="Снимок экрана: предупреждение о конфиденциальности.":::

Выберите **Continue** (Продолжить). На следующем экране выберите **Пропустить проверки уровней конфиденциальности для этого файла** > **Сохранить**.

После оценки данных Power Query создает дополнительный столбец с именем **AzureML.my-diabetes-model**.

:::image type="content" source="media/service-aml-integrate/scored-data.png" alt-text="Снимок экрана: добавленный столбец с оценкой.":::

Данные, возвращаемые службой, представлены в виде **списка**. 

> [!NOTE]
> Если вы развернули модель конструктора, вы увидите **запись**.

Чтобы получить прогнозы, на ленте **Преобразование** выберите **Развернуть столбец** > **Развернуть в новые строки**.

После развертывания вы увидите прогнозы в столбце AzureML.my-diabetes-model.

:::image type="content" source="media/service-aml-integrate/after-expand.png" alt-text="Снимок экрана: развертывание.":::

Выполните следующие шаги, чтобы завершить очистку модели данных.

1. Переименуйте столбец **AzureML.my-diabetes-model** в **predicted**.
1. Переименуйте столбец **Y** в **actual**.
1. Измените тип столбца **actual**: Выберите столбец, а затем на ленте **Преобразование** выберите **Тип данных** > **Десятичное число**.
1. Измените тип столбца **predicted**: Выберите этот столбец, а затем на ленте **Преобразование** выберите **Тип данных** > **Десятичное число**.
1. На ленте **Главная** выберите **Закрыть и применить**.

## <a name="create-a-report-with-visualizations"></a>Создание отчета с визуализациями

Теперь можно создать несколько визуализаций для отображения данных.

1. В области **Визуализации** выберите **График**. 
1. С выбранным графиком сделайте следующее:
1. Перетащите поле **AGE** в раздел **Оси**.
1. Перетащите поле **actual** в раздел **Значения**.
1. Перетащите поле **predicted** в раздел **Значения**.

Измените размер графика, чтобы он занимал максимальное пространство на странице. Теперь отчет содержит один график с двумя строками — одной для прогнозируемых и второй для фактических значений — с распределением по возрасту.

:::image type="content" source="media/service-aml-integrate/report-viz.png" alt-text="Снимок экрана: визуализация отчета.":::

## <a name="publish-the-report"></a>Публикация отчета

При необходимости вы можете добавить другие визуализации. В целях краткости в рамках этого руководства мы опубликуем отчет.

1. Сохраните отчет.
1. Выберите **Файл** > **Опубликовать** > **Опубликовать в Power BI**.
1. Войдите в службу Power BI.
1. Выберите **Моя рабочая область**.
1. После успешной публикации отчета откройте ссылку **Открыть <MY_PBIX_FILE.pbix> в Power BI**. В браузере откроется отчет Power BI.

     :::image type="content" source="media/service-aml-integrate/publish-success.png" alt-text="Снимок экрана: успешная публикация.":::

## <a name="enable-datasets-to-refresh"></a>Активация наборов данных для обновления

В случае, когда источник данных обновляется новыми данными для оценки, необходимо обновить учетные данные, чтобы данные можно было оценить. 

В области "Моя рабочая область" в службе Power BI в строке с черным заголовком выберите **Дополнительные параметры (...)**  > **Настройки** > **Настройки**.

:::image type="content" source="media/service-aml-integrate/settings-pbi.png" alt-text="Снимок экрана: настройки.":::

Выберите **Наборы данных**, разверните пункт **Учетные данные источников данных** и выберите **Изменить учетные данные**.

:::image type="content" source="media/service-aml-integrate/data-refresh.png" alt-text="Снимок экрана: обновление учетных данных.":::

Выполните инструкции для элементов **azureMLFunctions** и **Интернет**. Убедитесь, что выбран уровень конфиденциальности. Теперь вы можете задать **запланированное обновление** данных. Выберите **Частота обновления** и **Часовой пояс**. Вы также можете выбрать адрес электронной почты, на который Power BI будет отправлять уведомления об ошибках обновления.

:::image type="content" source="media/service-aml-integrate/schedule-refresh.png" alt-text="Снимок экрана: обновление набора данных и оценки.":::

Нажмите кнопку **Применить**.

>[!NOTE]
> При обновлении данные также отправляются в конечную точку Машинного обучения Azure для оценки.

## <a name="clean-up-resources"></a>Очистка ресурсов

>[!IMPORTANT]
>Созданные ресурсы можно использовать в качестве необходимых компонентов для других учебников и статей с практическими рекомендациями по Машинному обучению Azure.

Если вы не планируете использовать созданные ресурсы, удалите их, чтобы с вас не взималась плата.

1. На портале Azure выберите **Группы ресурсов** в левой части окна.
 
1. Выберите созданную группу ресурсов из списка.

1. Выберите **Удалить группу ресурсов**.

   ![Снимок экрана с выбранными параметрами для удаления группы ресурсов на портале Azure.](./media/service-aml-integrate/delete-resources.png)

1. Введите имя группы ресурсов. Теперь щелкните **Удалить**.
1. В области "Моя рабочая область" в службе Power BI удалите отчет и связанный набор данных. Вам не нужно удалять Power BI Desktop или отчет на компьютере. Power BI Desktop бесплатна.

## <a name="next-steps"></a>Дальнейшие действия

Из этой серии руководств вы узнали, как настроить расписание в Power BI, чтобы новые данные можно было оценивать, используя конечную точку оценки, в Машинном обучении Azure.
